# 任务模板使用规则

## 用户输入格式
[任务]: <描述你的任务>
[项目概述]: <输入项目概述,或包含详细信息的文件链接>   
[主分支]: <你的主分支名称>
[YOLO模式]: <询问|开启|关闭>

---

## 全局目标
1. 阅读底部的"用户输入"
2. 仔细阅读整个提示
3. 遵循"执行协议"
4. 在每个验证点停止等待人工确认
5. 将任务文件维护为核心真实来源

> 当你已阅读并完全理解以上全局目标时,必须回复"我理解主要目标",同时回复:
> - 全局目标的总结
> - 逐步重复执行协议的内容
> - 如果[YOLO模式]设置为"询问",询问用户是否要以"YOLO模式"继续

---

## 执行协议:

### 1. Git分支创建
1. 从[主分支]创建新的任务分支:  
   ```
   git checkout -b task/[任务标识符]_[任务日期编号]
   ```
2. 在[任务文件]的"任务分支"下添加分支名称
3. 验证分支是否激活:  
   ```
   git branch --show-current
   ```

### 2. 任务分析
- 逐步检查[任务]、相关代码和功能  

<<< 非YOLO模式时暂停: 继续之前,等待用户确认你的分析是否完整,如果不完整,重复此步骤 >>>

### 3. 任务文件创建
1. 创建[任务文件],命名为`[任务文件名]_[任务标识符].md`,放在项目根目录的`.tasks`目录中
2. 首先将"占位符定义"的所有内容原样添加到[任务文件]中
   - 这是为了确保其他开发者知道这些占位符的含义
3. 然后使用以下内容填充整个"任务文件模板":
   - 执行步骤2的结果
   - 用户提供的输入

<<< 非YOLO模式时暂停: 继续之前,等待用户确认[任务文件]名称和内容 >>>

### 4. 任务迭代
1. 在更改前完整分析代码上下文  
2. 分析[任务文件]中"任务进度"下的更新,确保不重复之前的错误或失败的更改
3. 根据需要对代码库进行更改  
4. 在[任务文件]中更新进度  
5. 对于每个更改:
   - 寻求用户确认更新
   - 用户确认后将更改标记为成功或失败
   - 可选,在适当时候(由你决定)提交代码:
      ```
      git add --all -- ':!./.tasks'
      git commit -m "[提交信息]"
      ```

<<< 非YOLO模式时暂停: 继续之前,与用户确认更改是否成功,如果不成功,再次迭代此执行步骤 >>>

### 5. 任务完成
1. 用户确认后,如果有更改需要提交:
   - 暂存除任务文件外的所有更改:
     ```
     git add --all -- ':!./.tasks'
     ```
   - 使用简洁的消息提交更改:
     ```
     git commit -m "[提交信息]"
     ```

### 6. 合并任务分支
1. 合并到[主分支]前与用户确认
2. 如果批准:
   - 检出[主分支]:  
     ```
     git checkout [主分支]
     ```
   - 合并:  
     ```
     git merge task/[任务标识符]_[任务日期编号]
     ```
3. 运行以下命令确认合并成功:
   ```
   git log [任务分支]..[主分支] | cat
   ```

### 7. 删除任务分支
1. 询问用户是否应删除[任务分支],如果否,继续执行步骤8
2. 删除[任务分支]:  
   ```
   git branch -d task/[任务标识符]_[任务日期编号]
   ```

### 8. 最终审查
1. 查看我们所做的一切,填写[任务文件]中的"最终审查"

---

## 任务文件模板:
```markdown
# Context
任务文件名: [任务文件名]
创建时间: [日期时间]
创建者: [用户名]
YOLO模式: [YOLO模式]

# 任务描述
[基于用户提供的[任务]的详细描述]

# 项目概述
[基于用户提供的[项目概述]的详细说明]

# 原始任务模板
[完整的未编辑的"任务文件模板"]
- 将完整的未编辑的"任务文件模板"复制粘贴到此部分
- 用markdown代码块包围
- 在此部分底部添加"请勿删除或编辑此部分"

# 原始执行协议
[完整的未编辑的"执行协议"部分]
- 将完整的未编辑的"执行协议"部分复制粘贴到此部分
- 用markdown代码块包围
- 在此部分底部添加"请勿删除或编辑此部分"

# 任务分析
- [任务]的目的
- 识别的问题，包括：
  - 造成的问题
  - 为什么需要解决
  - 实现细节和目标
- 其他有用的参考细节

# 主分支
[主分支]

# 任务分支
[任务分支]

# 执行步骤
[任务的可执行步骤列表]
- 没有任务时只写"—"

# 当前执行步骤: [当前执行步骤的编号]

# 任务进度
- 更新必须包含：
  - 必填：
    - [日期时间]
    - 用户确认后的成功/失败状态
  - 选填：
    - 发现、解决方案、阻碍和结果
    - 所有更新必须按时间顺序记录

# 最终审查
[仅在任务完成后填写]
```

## 占位符获取命令:
- [任务文件名]: `echo $(date +%Y-%m-%d)_$(($(find .tasks -maxdepth 1 -name "$(date +%Y-%m-%d)_*" | wc -l) + 1))`
- [日期时间]: `echo $(date +'%Y-%m-%d_%H:%M:%S')`
- [日期]: `echo $(date +'%Y-%m-%d')`
- [时间]: `echo $(date +'%H:%M:%S')`
- [用户名]: `echo $(whoami)`

---

## 占位符定义:
- [任务]: 要处理的具体任务或问题
- [任务标识符]: 任务的唯一可读标识符
- [任务文件名]: 任务文件的名称
- [任务日期编号]: 任务文件的时间戳和序列标识符
- [主分支]: 主要开发所在的分支(默认: "master")
- [任务文件]: 用于记录和跟踪任务进度的Markdown文件
- [任务分支]: 实施任务更改的Git分支
- [日期时间]: 当前日期和时间
- [日期]: 当前日期
- [时间]: 当前时间
- [用户名]: 当前用户名
- [提交信息]: 简短描述我们所做工作的提交消息
- [YOLO模式]: 是否处于YOLO模式,如果是,则忽略"<<< 暂停 >>>"标记 
```

---

## 使用说明
1. 开始新任务前的准备:
   - 仔细阅读此模板文件
   - 准备好任务描述和项目概述
   - 确定主分支名称
   - 决定是否使用YOLO模式

2. 创建任务文件步骤:
   - 使用占位符获取命令生成必要的信息
   - 在`.tasks`目录下创建新的任务文件
   - 按模板格式填写内容
   - 确保复制完整的原始任务模板和执行协议

3. 任务执行注意事项:
   - 严格按照执行协议的步骤进行
   - 在非YOLO模式下注意停止点
   - 及时更新任务进度
   - 保持任务文件的及时更新

4. 常见问题:
   - 分支命名规范: task/[任务标识符]_[任务日期编号]
   - 任务文件命名规范: [任务文件名]_[任务标识符].md
   - 提交信息要简洁明了
   - 记得排除.tasks目录的文件变更 